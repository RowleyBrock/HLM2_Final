knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(here)
library(rio)
library(equatiomatic)
library(easystats)
library(performance)
library(readr)
# Data below is SPSS file
year7 <- rio::import(here::here("data", "Year7_MLM.sav"))
view(year7)
grouped <- year7 %>%
group_by(RaceEthnicity) %>%
count()
view(grouped)
#I think data types (unknown) don't work for MLM, need factors.
#Tried to turn into factors, but didn't work
year7$PrimarySubstanceType.1 <- as.factor(year7$PrimarySubstanceType.1)
year7 <- year7 %>%
mutate(subtype = ifelse(PrimarySubstanceType.1 == 13, "Tobacco",
ifelse(PrimarySubstanceType.1 == 14, "Alcohol", "Drugs")),
Alcohol.1 = as.factor(year7$Alcohol.1),
Drugs.1 = as.factor(year7$Drugs.1),
Tobacco.1 = as.factor(year7$Tobacco.1),
RaceEthnicity = as.factor(year7$RaceEthnicity),
School = as.factor(year7$School),
District = as.factor(year7$District),
RaceEthnicity = case_when(RaceEthnicity == 1 ~ "Native",
RaceEthnicity == 2 ~ "Asian",
RaceEthnicity == 3 ~ "Latinx",
RaceEthnicity == 4 ~ "Black",
RaceEthnicity == 5 ~ "White",
RaceEthnicity == 8 ~ "Pacific_Islander",
RaceEthnicity == 44 ~ "Multi"),
RaceEthnicity = as.factor(year7$RaceEthnicity))
# RaceEthnicity == 6 ~ NA,
# RaceEthnicity == 7 ~ NA
#I'm hoping that these values will be NA anyway?
grouped_race_eth <- year7 %>%
group_by(RaceEthnicity) %>%
count()
#crosstabs race by ethnicity
tablesubxrace <- year7 %>%
group_by(RaceEthnicity, subtype) %>%
summarise(n = n()) %>%
spread(subtype, n)
view(tablesubxrace)
#unconditional models
uncond <- glmer(OSS_1stRef ~ 1 + (1|School), data = year7,
family = binomial)
# uncond1 <- glmer(OSS_1stRef ~ 1 + (1|School)+ (1|District), data = year7,
#                 family = binomial)
#look at distribution schools per district: 84% have 2 or fewer
#robust check, remove schools with only 1, run ICC again
sub <- glmer(OSS_1stRef ~  1 + Alcohol.1 + Drugs.1 + Tobacco.1 + (1|School),
data= year7,
family = binomial,
control = glmerControl(optimizer = "bobyqa")
race <- glmer(OSS_1stRef ~  RaceEthnicity + (1|School),
race <- glmer(OSS_1stRef ~ 1 + RaceEthnicity + (1|School),
data= year7,
family = binomial)
conditional_effect?
#
# summary(subnonest)
# summary(sub)
# icc(sub)
# confint(sub)
#
# exp(fixef(drug))
# exp(fixef(alc))
# exp(fixef(tob))
# exp(fixef(sub))
# summary(subnonest) #find code for
#
# sub1 <- glmer(OSS_1stRef ~  1 + Alcohol.1 + Drugs.1 + (1|School),
#              data= year7,
#              family = binomial)
??conditional_effect
?conditional_effect
??conditional_effect
library(brms)
conditional_effect(sub)
conditional_effects(sub)
conditional_effects(sub, "alc")
sub <- glmer(OSS_1stRef ~  1 + Alcohol.1 + Drugs.1 + Tobacco.1 + (1|School),
data= year7,
family = binomial,
control = glmerControl(optimizer = "bobyqa")
)
conditional_effects(sub, "alc")
conditional_effects(sub)
exp(coef(sub))
summary(sub)
exp(coef(sub))
confint(sub)
View(year7)
sub_medians <- year7 %>%
group_by(Alcohol.1, Drugs.1, Tobacco.1, RaceEthnicity)
View(sub_medians)
year7 <- year7 %>%
mutate(subtype = ifelse(PrimarySubstanceType.1 == 13, "Tobacco",
ifelse(PrimarySubstanceType.1 == 14, "Alcohol", "Drugs")),
Alcohol.1 = as.factor(year7$Alcohol.1),
Drugs.1 = as.factor(year7$Drugs.1),
Tobacco.1 = as.factor(year7$Tobacco.1),
RaceEthnicity = as.factor(year7$RaceEthnicity),
School = as.factor(year7$School),
District = as.factor(year7$District),
RaceEthnicity = case_when(RaceEthnicity == 1 ~ "Native",
RaceEthnicity == 2 ~ "Asian",
RaceEthnicity == 3 ~ "Latinx",
RaceEthnicity == 4 ~ "Black",
RaceEthnicity == 5 ~ "White",
RaceEthnicity == 8 ~ "Pacific_Islander",
RaceEthnicity == 44 ~ "Multi"),
RaceEthnicity = as.factor(year7$RaceEthnicity))
View(year7)
# Data below is SPSS file
year7 <- rio::import(here::here("data", "Year7_MLM.sav"))
View(year7)
year7 <- year7 %>%
mutate(subtype = ifelse(PrimarySubstanceType.1 == 13, "Tobacco",
ifelse(PrimarySubstanceType.1 == 14, "Alcohol", "Drugs")),
Alcohol.1 = as.factor(year7$Alcohol.1),
Drugs.1 = as.factor(year7$Drugs.1),
Tobacco.1 = as.factor(year7$Tobacco.1),
RaceEthnicity = as.factor(year7$RaceEthnicity),
School = as.factor(year7$School),
District = as.factor(year7$District),
RaceEthnicity = case_when(RaceEthnicity == 1 ~ "Native",
RaceEthnicity == 2 ~ "Asian",
RaceEthnicity == 3 ~ "Latinx",
RaceEthnicity == 4 ~ "Black",
RaceEthnicity == 5 ~ "White",
RaceEthnicity == 8 ~ "Pacific_Islander",
RaceEthnicity == 44 ~ "Multi"),
RaceEthnicity = as.factor(year7$RaceEthnicity))
View(year7)
year7 %>%
mutate(subtype = ifelse(PrimarySubstanceType.1 == 13, "Tobacco",
ifelse(PrimarySubstanceType.1 == 14, "Alcohol", "Drugs")),
Alcohol.1 = as.factor(year7$Alcohol.1),
Drugs.1 = as.factor(year7$Drugs.1),
Tobacco.1 = as.factor(year7$Tobacco.1),
RaceEthnicity = as.factor(year7$RaceEthnicity),
School = as.factor(year7$School),
District = as.factor(year7$District),
RaceEthnicity = case_when(RaceEthnicity == 1 ~ "Native",
RaceEthnicity == 2 ~ "Asian",
RaceEthnicity == 3 ~ "Latinx",
RaceEthnicity == 4 ~ "Black",
RaceEthnicity == 5 ~ "White",
RaceEthnicity == 8 ~ "Pacific_Islander",
RaceEthnicity == 44 ~ "Multi"),
RaceEthnicity = as.factor(year7$RaceEthnicity))
View(year7)
